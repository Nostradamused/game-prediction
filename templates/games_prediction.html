<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Games Prediction Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
        }

        button {
            padding: 8px;
            font-size: 16px;
            margin-top: 10px;
        }

        #selectedGames {
            margin-top: 20px;
        }

        #searchBar {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<h2>Select games for prediction:</h2>

<!-- Dropdown with a search bar for all games -->
<div id="searchBar">
    <input type="text" id="gameSearch" oninput="filterGames()" placeholder="Search games...">
</div>
<div>
    <select id="gameDropdown" multiple size="5"></select>
</div>

<!-- Button to add selected game to the list -->
<button onclick="addSelectedGame()">Add Selected Game</button>

<!-- Display the selected games list -->
<div id="selectedGames"></div>

<!-- Button to trigger API request -->
<button onclick="predictGames()">Predict Games</button>

<!-- Display the result -->
<div id="result"></div>

<script>
    // Function to fetch all games from API
    function fetchAllGames() {
        // Replace 'YOUR_API_ENDPOINT' with the actual API endpoint
        fetch('http://127.0.0.1:5000/all_games')
            .then(response => response.json())
            .then(data => {
                // Store the fetched games
                window.allGames = data;

                // Call the function to populate the game dropdown after fetching the games
                populateGameDropdown();
            })
            .catch(error => {
                console.error('Error fetching all games:', error);
            });
    }

    // Function to populate dropdown with all games
    function populateGameDropdown() {
        const dropdown = document.getElementById('gameDropdown');

        // Clear existing options
        dropdown.innerHTML = '';

        // Populate dropdown with all games
        allGames.forEach(game => {
            const option = document.createElement('option');
            option.value = game;
            option.text = game;
            dropdown.appendChild(option);
        });
    }

    // Call the function to fetch all games from the API on page load
    fetchAllGames();

    // Function to filter games based on the search bar input
    function filterGames() {
        const searchInput = document.getElementById('gameSearch').value.toLowerCase();
        const dropdown = document.getElementById('gameDropdown');

        // Filter and display games in the dropdown
        const filteredGames = allGames.filter(game => game.toLowerCase().includes(searchInput));
        dropdown.innerHTML = '';
        filteredGames.forEach(game => {
            const option = document.createElement('option');
            option.value = game;
            option.text = game;
            dropdown.appendChild(option);
        });
    }

    // Function to add selected game to the list
    function addSelectedGame() {
        const selectedGameDropdown = document.getElementById('gameDropdown');
        const selectedGamesList = document.getElementById('selectedGames');
        const selectedGame = selectedGameDropdown.value;

        // Check if the game is already in the list
        if (!selectedGamesList.innerHTML.includes(selectedGame)) {
            selectedGamesList.innerHTML += `<p>${selectedGame}</p>`;
        }
    }

    // Function to get selected games and trigger API request
    function predictGames() {
        const selectedGamesList = document.getElementById('selectedGames');
        const selectedGames = Array.from(selectedGamesList.getElementsByTagName('p')).map(p => p.textContent);

        if (selectedGames.length === 0) {
            alert('Please select at least one game.');
            return;
        }

        const gamesQueryString = `?games=${selectedGames.join('~')}`;

        // Replace 'YOUR_API_ENDPOINT' with the actual API endpoint
        fetch(`http://127.0.0.1:5000/games_prediction_api${gamesQueryString}`)
            .then(response => response.json())
            .then(data => {
                // split the string into an array
                console.log(data);
                // Display the result
                const resultContainer = document.getElementById('result');
                resultContainer.innerHTML = `<p>Prediction result:</p><ul>${data.games.map((game, index) => `<li>${game}: ${data.predictions[index]}%</li>`).join('')}</ul>`;
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                const resultContainer = document.getElementById('result');
                resultContainer.innerHTML = `<p>Error fetching data.</p>`;
            });
    }
</script>

</body>
</html>
